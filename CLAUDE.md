# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a personal Douban data synchronization repository that automatically fetches movie watching records from Douban and processes them for use in a Hugo static site. The project focuses on curating 5-star rated movies and making the data available via GitHub Pages.

## Commands

### Data Processing
- `node scripts/process-csv-simple.js` - Process raw Douban CSV data from `data/raw/movie.csv` into filtered `data/movies.json`

### Manual Workflow Triggers
- Navigate to GitHub Actions → "Sync Douban Data" → "Run workflow" to manually trigger data sync

## Architecture

### Data Flow
1. **GitHub Actions Workflow** (`.github/workflows/sync-douban.yml`) runs daily at Beijing time 00:00 (UTC 16:00)
2. **Doumark Action** (`lizheming/doumark-action`) fetches raw data from Douban user ID 59715677 into `data/raw/movie.csv`
3. **Data Processing** (`scripts/process-csv-simple.js`) filters for 5-star movies with incremental updates
4. **Image URLs** - Uses original Douban CDN URLs directly (no local download)
5. **Auto-commit** pushes JSON data and stats back to the repository

### Key Files
- `data/movies.json` - Final processed data (5-star movies only, max 100 entries)
- `data/stats.json` - Metadata about the data sync (count, last update, rating distribution)
- `data/raw/movie.csv` - Raw Douban CSV data (generated by GitHub Actions)
- `scripts/process-csv-simple.js` - Main data processing script with incremental updates

### Data Structure
Movies are filtered to 5-star ratings only and sorted by mark_date (descending). Each movie object contains:
- `title`, `year`, `rating`, `directors`, `genres`
- `poster_url` (original Douban CDN URLs)
- `douban_url`, `mark_date`, `comment`, `id`

### External Dependencies
- **Douban User ID**: 59715677 (hardcoded in workflow and scripts)
- **GitHub Actions**: lizheming/doumark-action for Douban data fetching
- **Hugo Site Integration**: Data consumed via raw GitHub URL at `https://raw.githubusercontent.com/luli-lula/douban-data/main/data/movies.json`

## Development Notes

- No build process or bundling required - pure Node.js scripts
- Minimal external dependencies (only Node.js built-in modules)
- **Incremental Updates**: Only processes new 5-star movies, avoiding reprocessing existing data
- Data processing includes year/director extraction from CSV card field
- Repository maintains clean separation between raw (`data/raw/`) and processed data (`data/`)
- **Image Strategy**: Uses original Douban CDN URLs directly for reliability
- **Usage Pattern**: Designed for low-volume updates (few movies marked per week)