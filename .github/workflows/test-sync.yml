name: Test Douban Sync

on:
  workflow_dispatch: # ä»…æ‰‹åŠ¨è§¦å‘ç”¨äºæµ‹è¯•

jobs:
  test-sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Sync Douban JSON Data
        uses: lizheming/doumark-action@master
        with:
          id: 59715677
          type: movie
          format: json
          status: done
          dir: ./data/raw
          
      - name: List generated files
        run: |
          echo "=== æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶ ==="
          ls -la ./data/raw/
          echo "=== JSON æ–‡ä»¶å†…å®¹ ==="
          if [ -f "./data/raw/movie.json" ]; then
            echo "JSONæ–‡ä»¶å¤§å°: $(wc -c < ./data/raw/movie.json) å­—èŠ‚"
            echo "JSONæ•°ç»„é•¿åº¦: $(jq '. | length' ./data/raw/movie.json)"
            echo "ç¬¬ä¸€ä¸ªç”µå½±ç¤ºä¾‹:"
            jq '.[0]' ./data/raw/movie.json
          else
            echo "JSONæ–‡ä»¶ä¸å­˜åœ¨"
          fi
          
      - name: Check git status
        run: |
          echo "=== GitçŠ¶æ€æ£€æŸ¥ ==="
          git status
          git add -A
          git status
          
      - name: Commit test results
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ§ª åŒæ­¥è±†ç“£åŸå§‹æ•°æ®'
          file_pattern: 'data/raw/*'
          commit_author: 'Douban Sync <sync@douban.local>'