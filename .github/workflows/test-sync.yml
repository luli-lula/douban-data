name: Test Douban Sync

on:
  workflow_dispatch: # ä»…æ‰‹åŠ¨è§¦å‘ç”¨äºæµ‹è¯•

jobs:
  test-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test Douban CSV Sync
        uses: lizheming/doumark-action@master
        with:
          id: 59715677
          type: movie
          format: csv
          status: done
          dir: ./data/raw
          
      - name: Test Douban JSON Sync
        uses: lizheming/doumark-action@master
        with:
          id: 59715677
          type: movie
          format: json
          status: done
          dir: ./data/raw
          
      - name: List generated files
        run: |
          echo "=== æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶ ==="
          ls -la ./data/raw/
          echo "=== CSV æ–‡ä»¶å†…å®¹ ==="
          if [ -f "./data/raw/movie.csv" ]; then
            head -5 ./data/raw/movie.csv
          else
            echo "CSVæ–‡ä»¶ä¸å­˜åœ¨"
          fi
          echo "=== JSON æ–‡ä»¶å†…å®¹ ==="
          if [ -f "./data/raw/movie.json" ]; then
            head -20 ./data/raw/movie.json
          else
            echo "JSONæ–‡ä»¶ä¸å­˜åœ¨"
          fi
          
      - name: Commit test results
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ§ª æµ‹è¯•è±†ç“£æ•°æ®åŒæ­¥ç»“æœ'
          file_pattern: 'data/raw/*'
          commit_author: 'Test Bot <test@example.com>'