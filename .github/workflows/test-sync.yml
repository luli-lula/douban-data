name: Test Douban Sync

on:
  workflow_dispatch: # 仅手动触发用于测试

jobs:
  test-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test Douban CSV Sync
        uses: lizheming/doumark-action@master
        with:
          id: 59715677
          type: movie
          format: csv
          status: done
          dir: ./data/raw
          
      - name: Test Douban JSON Sync
        uses: lizheming/doumark-action@master
        with:
          id: 59715677
          type: movie
          format: json
          status: done
          dir: ./data/raw
          
      - name: List generated files
        run: |
          echo "=== 检查生成的文件 ==="
          ls -la ./data/raw/
          echo "=== CSV 文件内容 ==="
          if [ -f "./data/raw/movie.csv" ]; then
            head -5 ./data/raw/movie.csv
          else
            echo "CSV文件不存在"
          fi
          echo "=== JSON 文件内容 ==="
          if [ -f "./data/raw/movie.json" ]; then
            head -20 ./data/raw/movie.json
          else
            echo "JSON文件不存在"
          fi
          
      - name: Commit test results
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '🧪 测试豆瓣数据同步结果'
          file_pattern: 'data/raw/*'
          commit_author: 'Test Bot <test@example.com>'